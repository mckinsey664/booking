{% extends "admin_dashboard.html" %}
{% block content %}
<div class="container-fluid">

  <!-- ðŸ—“ Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0 text-white fw-semibold">ðŸ—“ All Reservations</h2>
    <button class="btn btn-brand text-white fw-semibold" data-bs-toggle="modal" data-bs-target="#addReservationModal">
      + Add Reservation
    </button>
  </div>

  <!-- ðŸ§¾ Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} text-center mb-3 py-2">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- ðŸ” FRONTEND FILTERS -->
<div class="row g-3 mb-4">

  <!-- Filter by Date -->
  <div class="col-md-3">
    <label class="form-label text-white-50">Filter by Date</label>
    <select id="filterDate" class="form-select bg-dark text-white border-secondary">
      <option value="">All Dates</option>
      <option value="2025-12-09">December 9, 2025</option>
      <option value="2025-12-10">December 10, 2025</option>
    </select>
  </div>

  <!-- Filter by Room -->
  <div class="col-md-3">
    <label class="form-label text-white-50">Filter by Room</label>
    <select id="filterRoom" class="form-select bg-dark text-white border-secondary">
      <option value="">All Rooms</option>
      <option value="Sofitel The Obelisk - Al Neel 1">Sofitel The Obelisk - Al Neel 1</option>
      <option value="Sofitel The Obelisk - Al Neel 2">Sofitel The Obelisk - Al Neel 2</option>
    </select>
  </div>

</div>


  <!-- ðŸ“‹ Reservations Table -->
  {% if reservations %}
  <div class="card bg-dark border-0 shadow-sm p-3 rounded-3">
    <div class="table-responsive">
      <table class="table table-dark table-hover align-middle mb-0">
        <thead style="background-color: #CF6000;">
          <tr class="text-white text-center">
            <th>Meeting Date</th>
            <th>Meeting Time</th>
            <th>Room Nb</th>
            <th>Requester Name</th>
            <th>Invitee Name</th>
            <th>Status</th>
            <th>Delete</th>
          </tr>
        </thead>

        <tbody>
          {% for r in reservations %}
          <tr class="align-middle text-center">

            <!-- ðŸ“… DATE -->
            <td class="text-white fw-semibold">{{ r['date'] }}</td>

            <!-- â° TIME -->
            <td>
              <span class="badge bg-secondary fs-6 px-3 py-2">{{ r['start_time'] }}</span>
            </td>

            <!-- ðŸ  ROOM -->
            <td>
              <span class="badge bg-brand text-white fs-6 px-3 py-2">{{ r['room_name'] }}</span>
            </td>

            <!-- ðŸ‘¤ REQUESTER -->
            <td class="text-white">
              {{ r['booker_name'] }}
            </td>

            <!-- ðŸ‘¤ INVITEE -->
            <td class="text-white">
              {{ r['entity_name'] }}
            </td>

            <!-- ðŸ”µ STATUS -->
            <td>
              {% if r['status'] == 'Approved' %}
                <span class="badge bg-success px-3 py-2">Confirmed</span>
              {% elif r['status'] == 'Rejected' %}
                <span class="badge bg-danger px-3 py-2">Declined</span>
              {% else %}
                <span class="badge bg-warning text-dark px-3 py-2">Pending</span>
              {% endif %}
            </td>

            <!-- ðŸ—‘ DELETE -->
            <td>
              <form action="{{ url_for('delete_reservation', reservation_id=r['id']) }}" method="post" class="d-inline">
                <button type="submit" class="btn btn-outline-danger btn-sm px-3"
                        onclick="return confirm('Are you sure you want to delete this reservation?');">
                  ðŸ—‘
                </button>
              </form>
            </td>

          </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>

  {% else %}
    <div class="alert alert-secondary text-center mt-3 py-3">
      <strong>No reservations found.</strong>
    </div>
  {% endif %}
</div>


<!-- ðŸŽ¨ Custom Styling -->
<style>
  .btn-brand {
    background-color: #CF6000;
    border: none;
    transition: 0.3s;
  }
  .btn-brand:hover {
    background-color: #b85100;
  }
  .bg-brand { background-color: #CF6000 !important; }
  .table-hover tbody tr:hover {
    background-color: rgba(255, 255, 255, 0.05);
  }
  .badge { border-radius: 8px; }
  .alert-secondary {
    background-color: #2b2b2b;
    border: none;
    color: #d0d0d0;
    border-radius: 6px;
  }
  .form-control, .form-select {
    border-radius: 6px;
  }
</style>

<!-- ðŸ§© Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {

  const dateFilter = document.getElementById("filterDate");
  const roomFilter = document.getElementById("filterRoom");
  const rows = document.querySelectorAll("table tbody tr");

  function applyFilters() {
    const selectedDate = dateFilter.value;
    const selectedRoom = roomFilter.value;

    rows.forEach(row => {
      const rowDate = row.children[0].innerText.trim();
      const rowRoom = row.children[2].innerText.trim();  // Room column

      const matchesDate = !selectedDate || rowDate === selectedDate;
      const matchesRoom = !selectedRoom || rowRoom.includes(selectedRoom);

      if (matchesDate && matchesRoom) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  }

  dateFilter.addEventListener("change", applyFilters);
  roomFilter.addEventListener("change", applyFilters);

});
</script>

{% endblock %}
