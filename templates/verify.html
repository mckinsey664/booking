<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Verify Code | Room Reservation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
}
body {
  background: url("/static/bg.png") no-repeat center center fixed;
  background-size: cover;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  overflow: hidden;
}

.card {
  max-width: 400px;
  width: 100%;
  background-color: rgba(0, 0, 0, 0.65);
  border-radius: 12px;
  padding: 30px 25px;
  text-align: center;
}

.logo {
  display: block;
  margin: 0 auto 15px auto;
  max-width: 180px;
}

h3 {
  color: #ffffff;
  margin-bottom: 20px;
}

.code-inputs {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
}

.code-box {
  width: 60px;
  height: 60px;
  font-size: 24px;
  text-align: center;
  border-radius: 8px;
  border: 1px solid #ccc;
}

.loading-spinner {
  display: none;
  margin-top: 10px;
  color: #fff;
  font-size: 18px;
}

.alert {
  font-size: 14px;
  padding: 8px 10px;
}
  </style>
</head>

<body>
  <div class="card">
    <img src="{{ url_for('static', filename='logo.png') }}" class="logo">

    <h3>Email Verification</h3>

    <form method="POST" id="verifyForm">
      <div class="code-inputs">
        <input type="number" maxlength="1" class="code-box form-control text-center" required>
        <input type="number" maxlength="1" class="code-box form-control text-center" required>
        <input type="number" maxlength="1" class="code-box form-control text-center" required>
        <input type="number" maxlength="1" class="code-box form-control text-center" required>
      </div>

      <!-- Hidden full code -->
      <input type="hidden" name="code" id="code">

      <!-- üî• Loading indicator -->
      <div class="loading-spinner" id="loadingMsg">
        ‚è≥ Verifying...
      </div>

      <!-- ‚ùå Removed Verify button -->
    </form>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} mt-3 text-center">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

<script>
const boxes = document.querySelectorAll('.code-box');
const form = document.getElementById('verifyForm');
const hiddenCode = document.getElementById('code');
const loadingMsg = document.getElementById('loadingMsg');

boxes[0].focus();

boxes.forEach((box, idx) => {
  box.addEventListener('input', () => {
    if (box.value.length === 1 && idx < boxes.length - 1) {
      boxes[idx + 1].focus();
    }

    // When LAST digit entered ‚Üí auto-submit + show loading
    if (idx === boxes.length - 1 && box.value.length === 1) {
      let code = "";
      boxes.forEach(b => code += b.value);

      hiddenCode.value = code;

      // Disable inputs during verify
      boxes.forEach(b => b.disabled = true);

      // Show loading
      loadingMsg.style.display = "block";

      form.submit();
    }
  });

  // Backspace behavior
  box.addEventListener('keydown', (e) => {
    if (e.key === "Backspace" && box.value === "" && idx > 0) {
      boxes[idx - 1].focus();
    }
  });
});
</script>

</body>
</html>
