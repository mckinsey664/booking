{% extends "admin_dashboard.html" %}
{% block content %}
<h2 class="mb-4">Approved Users</h2>

<!-- ‚úÖ Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} text-center mb-3">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- ‚úÖ Import Button e-->
<form method="POST" class="mb-4">
  <input type="hidden" name="action" value="import">
  <button class="btn btn-brand text-white">üì• Import Approved Users from Google Sheets</button>
</form>

<form action="{{ url_for('clear_approved_users') }}" method="POST"
      onsubmit="return confirm('Are you sure you want to delete ALL approved users? This action cannot be undone.');">
    <button class="btn btn-danger mb-3">
        üóëÔ∏è Delete ALL Approved Users
    </button>
</form>


<!-- üîç Search Bar -->
<div class="mb-3">
  <input type="text" id="searchInput" class="form-control" placeholder="Search by any field..." style="max-width:400px;">
</div>

<!-- ‚úÖ Users Table -->
<div class="table-responsive">
  <table id="usersTable" class="table table-dark table-striped table-hover align-middle">
    <thead style="background-color:#CF6000; color:white;">
      <tr>
        <th>First</th>
        <th>Last</th>
        <th>Email</th>
        <th>Company</th>
        <th>Position</th>
        <th>Phone</th>
        <th>Passport #</th>
        <th>Place of Issuance</th>
        <th>Expiry</th>
        <th>Birth Date</th>
        <th>Created</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ u['first_name'] }}</td>
        <td>{{ u['last_name'] }}</td>
        <td>{{ u['email'] }}</td>
        <td>{{ u['company_name'] }}</td>
        <td>{{ u['position'] }}</td>
        <td>{{ u['phone'] or '-' }}</td>
        <td>{{ u['passport_number'] or '-' }}</td>
        <td>{{ u['passport_place'] or '-' }}</td>
        <td>{{ u['passport_expiry'] or '-' }}</td>
        <td>{{ u['birth_date'] or '-' }}</td>
        <td>{{ u['created_date'] }}</td>
        <td>
          <a href="{{ url_for('edit_approved_user', user_id=u['id']) }}"
          class="btn btn-warning btn-sm">
          Edit
          </a>
        </td>
        <td>
          <form method="POST" 
                action="{{ url_for('delete_approved_user', user_id=u['id']) }}"
                onsubmit="return confirm('Are you sure you want to delete this user?');">
            <button class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- üîç Live Search Script -->
<script>
  document.getElementById('searchInput').addEventListener('keyup', function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll('#usersTable tbody tr');
    rows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(filter) ? '' : 'none';
    });
  });
</script>

{% endblock %}
