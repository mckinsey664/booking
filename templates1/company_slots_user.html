{% extends "company_dashboard.html" %}
{% block content %}

<!-- ðŸ¢ Header -->
<div class="alert alert-dark border-0 text-white shadow-sm bg-opacity-75" style="background-color:#343a40;">
  You are managing available time slots for <strong>{{ company_name }}</strong>.
</div>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="text-white fw-semibold">{{ company_name }} â€” Time Slots</h2>
  <button class="btn btn-brand text-white fw-semibold" data-bs-toggle="modal" data-bs-target="#addSlotModal">
    + Add Time Slot
  </button>
</div>

<!-- ðŸ”” Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- ðŸ“… Time Slots Table -->
{% if slots %}
<div class="card bg-dark border-0 shadow-sm rounded-3">
  <div class="card-body p-0">
    <table class="table table-dark table-hover align-middle mb-0">
      <thead style="background-color:#CF6000;" class="text-white text-center">
        <tr>
          <th>Date</th>
          <th>Start</th>
          <th>End</th>
        </tr>
      </thead>
      <tbody class="text-center">
        {% for s in slots %}
        <tr>
          <td class="fw-semibold">{{ s['date'] }}</td>
          <td><span class="badge bg-secondary fs-6 px-3 py-2">{{ s['start_time'] }}</span></td>
          <td><span class="badge bg-success fs-6 px-3 py-2">{{ s['end_time'] }}</span></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="alert alert-secondary text-center mt-3 py-3 border-0 bg-opacity-50 bg-dark text-light">
  <strong>No time slots added yet.</strong>
</div>
{% endif %}

<!-- ðŸŸ§ Add Slot Modal -->
<div class="modal fade" id="addSlotModal" tabindex="-1" aria-labelledby="addSlotModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white border-0">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="addSlotModalLabel">Add New Time Slot</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="post">
          <div class="mb-3">
            <label class="form-label text-white-50">Date</label>
            <select name="date" class="form-select bg-dark text-white border-secondary" required>
              <option value="">Choose...</option>
              <option value="2025-12-09">December 9, 2025</option>
              <option value="2025-12-10">December 10, 2025</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label text-white-50">Start Time (10:00 â†’ 15:30)</label>
            <input type="time" id="start_time" name="start_time"
                   class="form-control bg-dark text-white border-secondary"
                   min="10:00" max="15:30" step="1800" required>
            <small class="text-muted">End time will be calculated automatically (30 min duration)</small>
            <input type="hidden" id="end_time" name="end_time">
          </div>

          <div class="text-end mt-4">
            <button type="submit" class="btn btn-brand text-white px-4">Add Slot</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ðŸŽ¨ Styles -->
<style>
  .btn-brand {
    background-color: #CF6000;
    border: none;
    transition: 0.3s;
  }
  .btn-brand:hover {
    background-color: #b85100;
  }
  .table-hover tbody tr:hover {
    background-color: rgba(255,255,255,0.05);
  }
  .badge {
    border-radius: 8px;
  }
  .modal-content {
    border-radius: 10px;
    box-shadow: 0 4px 25px rgba(0,0,0,0.4);
  }
  .alert-dark {
    background-color: rgba(33,37,41,0.85);
  }
</style>

<!-- ðŸ•’ JS Auto End Time -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const startInput = document.getElementById('start_time');
  const endHidden = document.getElementById('end_time');

  startInput.addEventListener('input', () => {
    if (!startInput.value) {
      endHidden.value = "";
      return;
    }
    const [h, m] = startInput.value.split(':').map(Number);
    const endMin = h * 60 + m + 30;
    const eh = String(Math.floor(endMin / 60)).padStart(2, '0');
    const em = String(endMin % 60).padStart(2, '0');
    endHidden.value = `${eh}:${em}`;
  });
</script>

{% endblock %}
